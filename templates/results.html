{% extends "report.html" %}
{% block results %}
<h1>Results</h1>

{% for race in races -%}
<h2>Race {{ race.name }}</h2>
<p>{{ race.n_total }} tests ran. </p>

<table class="results-table summary-table">
    <tr>
        <th>Model</th>
        <th>Pass %</th>
        <th>Total Passed Tests</th>
        <th>Total Failed Tests</th>
    </tr>

    {% for model_set in race.model_sets -%}
    <tr class="results-table-row">
        <td onclick="scroll_to_model(this)" class="{{ race.name }} scroller">{{ model_set.name }}</td>
        <td class="summary-result rel_pass">{{ model_set.rel_pass }}</td>
        <td class="summary-result">{{ model_set.n_passed }}</td>
        <td class="summary-result">{{ model_set.n_failed }}</td>
    </tr>
    {%- endfor %}

    <tr style="font-weight:bold">
        <td>Totals</td>
        <td class="rel_pass">{{ race.rel_total_pass }}</td>
        <td>{{ race.n_total_passed }}</td>
        <td>{{ race.n_total_failed }}</td>
    </tr>

</table>

{% for model_set in race.model_sets -%}
<h2>Tests for {{ model_set.name }}</h2>
<p class="filter" hidden="true">(Un)check the boxes to filter the results.</p>
<h2>Results</h2>

{% macro checkbox(type, n) -%}
<input 
    checked="true" 
    class="filter" 
    data-suffix-id="{{ race.name }}" 
    data-test-result="{{ type }}" 
    hidden="true" 
    name="filter_checkbox" 
    onChange="filter_table(this)" 
    type="checkbox" 
/>
<span class="{{ type }}">{{ n }} {{ type }}</span>
{%- endmacro %}
{{ checkbox('passed',  model_set.n_passed) }},
{{ checkbox('skipped', model_set.n_skipped) }},
{{ checkbox('failed',  model_set.n_failed) }},
{{ checkbox('error',   model_set.n_errors) }},
{{ checkbox('xfailed', model_set.n_xfail) }},
{{ checkbox('xpassed', model_set.n_xpass) }}

<table class="results-table {{ model_set.name }}-{{ race.name }}" id="results-table-{{ race.name }}">
    <thead id="_default-results-table-head">
        <tr>
            <th class="sortable result initial-sort" col="result">Result</th>
            <th class="sortable" col="name">Test</th>
            <th class="sortable numeric" col="duration">Duration</th>
        </tr>
        <tr hidden="true" id="not-found-message{{ race.name }}">
            <th colspan="3">No results found. Try to check the filters</th>
        </tr>
    </thead>
    {% for test in model_set.tests -%}
        {% block table_row scoped -%}{%- endblock %}
    {%- endfor %}
</table>
{%- endfor %}

{%- endfor %}
{% endblock %}